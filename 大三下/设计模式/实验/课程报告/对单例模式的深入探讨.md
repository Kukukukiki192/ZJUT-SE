# 1 ä»‹ç»

**å®šä¹‰**ï¼š
å•ä¾‹æ¨¡å¼ï¼ˆSingleton Patternï¼‰æ˜¯ Java ä¸­æœ€ç®€å•çš„è®¾è®¡æ¨¡å¼ä¹‹ä¸€. è¿™ç§ç±»å‹çš„è®¾è®¡æ¨¡å¼å±äº**åˆ›å»ºå‹æ¨¡å¼**ï¼Œå®ƒæä¾›äº†ä¸€ç§åˆ›å»ºå¯¹è±¡çš„æœ€ä½³æ–¹å¼
è¿™ç§æ¨¡å¼æ¶‰åŠåˆ°ä¸€ä¸ªå•ä¸€çš„ç±»ï¼Œè¯¥ç±»è´Ÿè´£åˆ›å»ºè‡ªå·±çš„å¯¹è±¡ï¼ŒåŒæ—¶ç¡®ä¿åªæœ‰å•ä¸ªå¯¹è±¡è¢«åˆ›å»º. è¿™ä¸ªç±»æä¾›äº†ä¸€ç§è®¿é—®å…¶å”¯ä¸€çš„å¯¹è±¡çš„æ–¹å¼ï¼Œå¯ä»¥ç›´æ¥è®¿é—®ï¼Œä¸éœ€è¦å®ä¾‹åŒ–è¯¥ç±»çš„å¯¹è±¡

**æ„å›¾**ï¼šä¿è¯ä¸€ä¸ªç±»ä»…æœ‰ä¸€ä¸ªå®ä¾‹ï¼Œå¹¶æä¾›ä¸€ä¸ªè®¿é—®å®ƒçš„å…¨å±€è®¿é—®ç‚¹

**ä¸»è¦è§£å†³**ï¼šä¸€ä¸ªå…¨å±€ä½¿ç”¨çš„ç±»é¢‘ç¹åœ°åˆ›å»ºä¸é”€æ¯

**ä½•æ—¶ä½¿ç”¨**ï¼šå½“æ‚¨æƒ³æ§åˆ¶å®ä¾‹æ•°ç›®ï¼ŒèŠ‚çœç³»ç»Ÿèµ„æºçš„æ—¶å€™

**å¦‚ä½•è§£å†³**ï¼šåˆ¤æ–­ç³»ç»Ÿæ˜¯å¦å·²ç»æœ‰è¿™ä¸ªå•ä¾‹ï¼Œå¦‚æœæœ‰åˆ™è¿”å›ï¼Œå¦‚æœæ²¡æœ‰åˆ™åˆ›å»º

**å…³é”®ä»£ç **ï¼šæ„é€ å‡½æ•°æ˜¯ç§æœ‰çš„

**æ³¨æ„äº‹é¡¹**ï¼šgetInstance() æ–¹æ³•ä¸­éœ€è¦ä½¿ç”¨åŒæ­¥é” synchronized (Singleton.class) é˜²æ­¢å¤šçº¿ç¨‹åŒæ—¶è¿›å…¥é€ æˆ 
instance è¢«å¤šæ¬¡å®ä¾‹åŒ–

**ç‰¹ç‚¹**ï¼š

1. å•ä¾‹ç±»åªèƒ½æœ‰ä¸€ä¸ªå®ä¾‹
2. å•ä¾‹ç±»å¿…é¡»è‡ªå·±åˆ›å»ºè‡ªå·±çš„å”¯ä¸€å®ä¾‹
3. å•ä¾‹ç±»å¿…é¡»ç»™æ‰€æœ‰å…¶ä»–å¯¹è±¡æä¾›è¿™ä¸€å®ä¾‹

# 2 ä¼˜ç¼ºç‚¹

**ä¼˜ç‚¹**

- åœ¨å†…å­˜é‡Œåªæœ‰ä¸€ä¸ªå®ä¾‹ï¼Œå‡å°‘äº†å†…å­˜çš„å¼€é”€ï¼Œå°¤å…¶æ˜¯é¢‘ç¹çš„åˆ›å»ºå’Œé”€æ¯å®ä¾‹ï¼ˆæ¯”å¦‚ç®¡ç†å­¦é™¢é¦–é¡µé¡µé¢ç¼“å­˜ï¼‰
- å¯ä»¥é¿å…å¯¹èµ„æºçš„å¤šé‡å ç”¨ï¼ˆæ¯”å¦‚å†™æ–‡ä»¶æ“ä½œï¼‰
- å•ä¾‹æ¨¡å¼è®¾ç½®å…¨å±€è®¿é—®ç‚¹ï¼Œå¯ä»¥ä¼˜åŒ–å’Œå…±äº«èµ„æºçš„è®¿é—®

**ç¼ºç‚¹**

- å•ä¾‹æ¨¡å¼ä¸€èˆ¬æ²¡æœ‰æ¥å£ï¼Œæ‰©å±•å›°éš¾. å¦‚æœè¦æ‰©å±•ï¼Œåˆ™é™¤äº†ä¿®æ”¹åŸæ¥çš„ä»£ç ï¼Œæ²¡æœ‰ç¬¬äºŒç§é€”å¾„ï¼Œè¿èƒŒå¼€é—­åŸåˆ™
- åœ¨å¹¶å‘æµ‹è¯•ä¸­ï¼Œå•ä¾‹æ¨¡å¼ä¸åˆ©äºä»£ç è°ƒè¯•. åœ¨è°ƒè¯•è¿‡ç¨‹ä¸­ï¼Œå¦‚æœå•ä¾‹ä¸­çš„ä»£ç æ²¡æœ‰æ‰§è¡Œå®Œï¼Œä¹Ÿä¸èƒ½æ¨¡æ‹Ÿç”Ÿæˆä¸€ä¸ªæ–°çš„å¯¹è±¡
- å•ä¾‹æ¨¡å¼çš„åŠŸèƒ½ä»£ç é€šå¸¸å†™åœ¨ä¸€ä¸ªç±»ä¸­ï¼Œå¦‚æœåŠŸèƒ½è®¾è®¡ä¸åˆç†ï¼Œåˆ™å¾ˆå®¹æ˜“è¿èƒŒå•ä¸€èŒè´£åŸåˆ™

# 3 åº”ç”¨åœºæ™¯

å¯¹äº Java æ¥è¯´ï¼Œå•ä¾‹æ¨¡å¼å¯ä»¥ä¿è¯åœ¨ä¸€ä¸ª JVM ä¸­åªå­˜åœ¨å•ä¸€å®ä¾‹. å•ä¾‹æ¨¡å¼çš„åº”ç”¨åœºæ™¯ä¸»è¦æœ‰ä»¥ä¸‹å‡ ä¸ªæ–¹é¢

- éœ€è¦é¢‘ç¹åˆ›å»ºçš„ä¸€äº›ç±»ï¼Œä½¿ç”¨å•ä¾‹å¯ä»¥é™ä½ç³»ç»Ÿçš„å†…å­˜å‹åŠ›ï¼Œå‡å°‘ GC
- æŸç±»åªè¦æ±‚ç”Ÿæˆä¸€ä¸ªå¯¹è±¡çš„æ—¶å€™ï¼Œå¦‚ä¸€ä¸ªç­ä¸­çš„ç­é•¿ã€æ¯ä¸ªäººçš„èº«ä»½è¯å·ã€è¦æ±‚ç”Ÿäº§å”¯ä¸€çš„åºåˆ—å·ç­‰
- æŸäº›ç±»åˆ›å»ºå®ä¾‹æ—¶å ç”¨èµ„æºè¾ƒå¤šï¼Œæˆ–å®ä¾‹åŒ–è€—æ—¶è¾ƒé•¿ï¼Œä¸”ç»å¸¸ä½¿ç”¨
- æŸç±»éœ€è¦é¢‘ç¹å®ä¾‹åŒ–ï¼Œè€Œåˆ›å»ºçš„å¯¹è±¡åˆé¢‘ç¹è¢«é”€æ¯çš„æ—¶å€™ï¼Œå¦‚å¤šçº¿ç¨‹çš„çº¿ç¨‹æ± ã€ç½‘ç»œè¿æ¥æ± ç­‰
- é¢‘ç¹è®¿é—®æ•°æ®åº“æˆ–æ–‡ä»¶çš„å¯¹è±¡
- å¯¹äºä¸€äº›æ§åˆ¶ç¡¬ä»¶çº§åˆ«çš„æ“ä½œï¼Œæˆ–è€…ä»ç³»ç»Ÿä¸Šæ¥è®²åº”å½“æ˜¯å•ä¸€æ§åˆ¶é€»è¾‘çš„æ“ä½œï¼Œå¦‚æœæœ‰å¤šä¸ªå®ä¾‹ï¼Œåˆ™ç³»ç»Ÿä¼šå®Œå…¨ä¹±å¥—
- å½“å¯¹è±¡éœ€è¦è¢«å…±äº«çš„åœºåˆ. ç”±äºå•ä¾‹æ¨¡å¼åªå…è®¸åˆ›å»ºä¸€ä¸ªå¯¹è±¡ï¼Œå…±äº«è¯¥å¯¹è±¡å¯ä»¥èŠ‚çœå†…å­˜ï¼Œå¹¶åŠ å¿«å¯¹è±¡è®¿é—®é€Ÿåº¦. å¦‚ Web ä¸­çš„é…ç½®å¯¹è±¡ã€æ•°æ®åº“çš„è¿æ¥æ± ç­‰

â€‹	åœ¨è®¡ç®—æœºç³»ç»Ÿä¸­ï¼Œè¿˜æœ‰ Windows çš„å›æ”¶ç«™ã€æ“ä½œç³»ç»Ÿä¸­çš„æ–‡ä»¶ç³»ç»Ÿã€å¤šçº¿ç¨‹ä¸­çš„çº¿ç¨‹æ± ã€æ˜¾å¡çš„é©±åŠ¨ç¨‹åºå¯¹è±¡ã€æ‰“å°æœºçš„åå°å¤„ç†æœåŠ¡ã€åº”ç”¨ç¨‹åºçš„æ—¥å¿—å¯¹è±¡ã€æ•°æ®åº“çš„è¿æ¥æ± ã€ç½‘ç«™çš„è®¡æ•°å™¨ã€Web åº”ç”¨çš„é…ç½®å¯¹è±¡ã€åº”ç”¨ç¨‹åºä¸­çš„å¯¹è¯æ¡†ã€ç³»ç»Ÿä¸­çš„ç¼“å­˜ç­‰å¸¸å¸¸è¢«è®¾è®¡æˆå•ä¾‹ï¼ˆWindows æ˜¯å¤šè¿›ç¨‹å¤šçº¿ç¨‹çš„ï¼Œåœ¨æ“ä½œä¸€ä¸ªæ–‡ä»¶çš„æ—¶å€™ï¼Œå°±ä¸å¯é¿å…åœ°å‡ºç°å¤šä¸ªè¿›ç¨‹æˆ–çº¿ç¨‹åŒæ—¶æ“ä½œä¸€ä¸ªæ–‡ä»¶çš„ç°è±¡ï¼Œæ‰€ä»¥æ‰€æœ‰æ–‡ä»¶çš„å¤„ç†å¿…é¡»é€šè¿‡å”¯ä¸€çš„å®ä¾‹æ¥è¿›è¡Œï¼‰

â€‹	å•ä¾‹æ¨¡å¼åœ¨ç°å®ç”Ÿæ´»ä¸­çš„åº”ç”¨ä¹Ÿéå¸¸å¹¿æ³›ï¼Œä¾‹å¦‚å…¬å¸ CEOã€éƒ¨é—¨ç»ç†ã€ä¸€ä¸ªç­çº§åªæœ‰ä¸€ä¸ªç­ä¸»ä»»ç­‰éƒ½å±äºå•ä¾‹æ¨¡å‹. J2EE æ ‡å‡†ä¸­çš„ ServletContext å’Œ ServletContextConfigã€Spring æ¡†æ¶åº”ç”¨ä¸­çš„ ApplicationContextã€æ•°æ®åº“ä¸­çš„è¿æ¥æ± ç­‰ä¹Ÿéƒ½æ˜¯å•ä¾‹æ¨¡å¼. ä¸€äº›è®¾å¤‡ç®¡ç†å™¨ä¹Ÿå¸¸å¸¸è®¾è®¡ä¸ºå•ä¾‹æ¨¡å¼ï¼Œæ¯”å¦‚ä¸€ä¸ªç”µè„‘æœ‰ä¸¤å°æ‰“å°æœºï¼Œåœ¨è¾“å‡ºçš„æ—¶å€™å°±è¦å¤„ç†ä¸èƒ½ä¸¤å°æ‰“å°æœºæ‰“å°åŒä¸€ä¸ªæ–‡ä»¶. è¿˜æœ‰WEB ä¸­çš„è®¡æ•°å™¨ï¼Œä¸ç”¨æ¯æ¬¡åˆ·æ–°éƒ½åœ¨æ•°æ®åº“é‡ŒåŠ ä¸€æ¬¡ï¼Œå¯ä»¥ç”¨å•ä¾‹å…ˆç¼“å­˜èµ·æ¥

# 4 ç»“æ„

å•ä¾‹æ¨¡å¼çš„ä¸»è¦è§’è‰²ï¼š

- å•ä¾‹ç±». åªèƒ½åˆ›å»ºä¸€ä¸ªå®ä¾‹çš„ç±»
- è®¿é—®ç±». ä½¿ç”¨å•ä¾‹ç±»

![](https://github.com/Kukukukiki192/TyporaImg/raw/main/img/SinglePattern.png)

# 5 å®ç°

> å•ä¾‹è®¾è®¡æ¨¡å¼åˆ†ç±»2ç§ï¼š
> 	é¥¿æ±‰å¼ï¼šç±»åŠ è½½å°±ä¼šå¯¼è‡´è¯¥å•å®ä¾‹å¯¹è±¡è¢«åˆ›å»º
> 	æ‡’æ±‰å¼ï¼šç±»åŠ è½½ä¸ä¼šå¯¼è‡´è¯¥å•å®ä¾‹å¯¹è±¡è¢«åˆ›å»ºï¼Œè€Œæ˜¯é¦–æ¬¡ä½¿ç”¨è¯¥å¯¹è±¡æ—¶æ‰ä¼šåˆ›å»º


## 5.1 é¥¿æ±‰å¼-æ–¹å¼1ï¼ˆé™æ€å˜é‡æ–¹å¼ï¼‰ 
```java
/**
 * é¥¿æ±‰å¼(å¸¸ç”¨)
 *      é™æ€å˜é‡åˆ›å»ºç±»çš„å¯¹è±¡
 
 * é€šå¸¸ï¼Œæ™®é€šç±»çš„æ„é€ å‡½æ•°æ˜¯å…¬æœ‰çš„ï¼Œå¤–éƒ¨ç±»å¯ä»¥é€šè¿‡â€œnew æ„é€ å‡½æ•°()â€æ¥ç”Ÿæˆå¤šä¸ªå®ä¾‹
 * ä½†æ˜¯ï¼Œå¦‚æœå°†ç±»çš„æ„é€ å‡½æ•°è®¾ä¸ºç§æœ‰çš„ï¼Œå¤–éƒ¨ç±»å°±æ— æ³•è°ƒç”¨è¯¥æ„é€ å‡½æ•°ï¼Œä¹Ÿå°±æ— æ³•ç”Ÿæˆå¤šä¸ªå®ä¾‹
 * è¿™æ—¶è¯¥ç±»è‡ªèº«å¿…é¡»å®šä¹‰ä¸€ä¸ªé™æ€ç§æœ‰å®ä¾‹ï¼Œå¹¶å‘å¤–æä¾›ä¸€ä¸ªé™æ€çš„å…¬æœ‰å‡½æ•°ç”¨äºåˆ›å»ºæˆ–è·å–è¯¥é™æ€ç§æœ‰å®ä¾‹
 */
public class Singleton {
    //ç§æœ‰æ„é€ æ–¹æ³•
    private Singleton() {}

    //åœ¨æˆå‘˜ä½ç½®åˆ›å»ºè¯¥ç±»çš„å¯¹è±¡
    private static Singleton instance = new Singleton();

    //å¯¹å¤–æä¾›é™æ€æ–¹æ³•è·å–è¯¥å¯¹è±¡(è·å–å”¯ä¸€å¯ç”¨çš„å¯¹è±¡)
    public static Singleton getInstance() {
        return instance;
    }
}
```
è¯´æ˜ï¼š
	æ–¹å¼åœ¨æˆå‘˜ä½ç½®å£°æ˜Singletonç±»å‹çš„é™æ€å˜é‡ï¼Œå¹¶åˆ›å»ºSingletonç±»çš„å¯¹è±¡instance. instanceå¯¹è±¡æ˜¯éšç€ç±»çš„åŠ è½½è€Œåˆ›å»ºçš„. å¦‚æœè¯¥å¯¹è±¡è¶³å¤Ÿå¤§çš„è¯ï¼Œè€Œä¸€ç›´æ²¡æœ‰ä½¿ç”¨å°±ä¼šé€ æˆå†…å­˜çš„æµªè´¹
	å®ƒåŸºäº classloader æœºåˆ¶é¿å…äº†å¤šçº¿ç¨‹çš„åŒæ­¥é—®é¢˜ï¼Œä¸è¿‡ï¼Œinstance åœ¨ç±»è£…è½½æ—¶å°±å®ä¾‹åŒ–ï¼Œè™½ç„¶å¯¼è‡´ç±»è£…è½½çš„åŸå› æœ‰å¾ˆå¤šç§ï¼Œåœ¨å•ä¾‹æ¨¡å¼ä¸­å¤§å¤šæ•°éƒ½æ˜¯è°ƒç”¨ getInstance æ–¹æ³•ï¼Œ ä½†æ˜¯ä¹Ÿä¸èƒ½ç¡®å®šæœ‰å…¶ä»–çš„æ–¹å¼ï¼ˆæˆ–è€…å…¶ä»–çš„é™æ€æ–¹æ³•ï¼‰å¯¼è‡´ç±»è£…è½½ï¼Œè¿™æ—¶å€™åˆå§‹åŒ– instance æ˜¾ç„¶æ²¡æœ‰è¾¾åˆ° lazy loading çš„æ•ˆæœ
	é¥¿æ±‰å¼å•ä¾‹å®ç°æ˜¯çº¿ç¨‹å®‰å…¨çš„. çº¿ç¨‹ä¸å®‰å…¨é—®é¢˜ä¸»è¦æ˜¯ç”±äº instance è¢«å®ä¾‹åŒ–å¤šæ¬¡ï¼Œé‡‡å–ç›´æ¥å®ä¾‹åŒ–instance çš„æ–¹å¼å°±ä¸ä¼šäº§ç”Ÿçº¿ç¨‹ä¸å®‰å…¨é—®é¢˜. ä½†æ˜¯ç›´æ¥å®ä¾‹åŒ–çš„æ–¹å¼ä¹Ÿä¸¢å¤±äº†å»¶è¿Ÿå®ä¾‹åŒ–å¸¦æ¥çš„èŠ‚çº¦èµ„æºçš„å¥½å¤„

## 5.2 é¥¿æ±‰å¼-æ–¹å¼2ï¼ˆé™æ€ä»£ç å—æ–¹å¼ï¼‰ 
```java
/**
 * æ¶æ±‰å¼
 *      åœ¨é™æ€ä»£ç å—ä¸­åˆ›å»ºè¯¥ç±»å¯¹è±¡
 */
public class Singleton {

    //ç§æœ‰æ„é€ æ–¹æ³•
    private Singleton() {}

    //åœ¨æˆå‘˜ä½ç½®åˆ›å»ºè¯¥ç±»çš„å¯¹è±¡
    private static Singleton instance;

    static {
        instance = new Singleton();
    }

    //å¯¹å¤–æä¾›é™æ€æ–¹æ³•è·å–è¯¥å¯¹è±¡
    public static Singleton getInstance() {
        return instance;
    }
}
```
è¯´æ˜ï¼š
	è¯¥æ–¹å¼åœ¨æˆå‘˜ä½ç½®å£°æ˜Singletonç±»å‹çš„é™æ€å˜é‡ï¼Œè€Œå¯¹è±¡çš„åˆ›å»ºæ˜¯åœ¨é™æ€ä»£ç å—ä¸­ï¼Œä¹Ÿæ˜¯å¯¹ç€ç±»çš„åŠ è½½è€Œåˆ›å»º. æ‰€ä»¥å’Œé¥¿æ±‰å¼çš„æ–¹å¼1åŸºæœ¬ä¸Šä¸€æ ·ï¼Œå½“ç„¶è¯¥æ–¹å¼ä¹Ÿå­˜åœ¨å†…å­˜æµªè´¹é—®é¢˜

## 5.3 æ‡’æ±‰å¼-æ–¹å¼1ï¼ˆçº¿ç¨‹ä¸å®‰å…¨ï¼‰ 
```java
/**
 * æ‡’æ±‰å¼
 *  çº¿ç¨‹ä¸å®‰å…¨
 */
public class Singleton {
    //ç§æœ‰æ„é€ æ–¹æ³•
    private Singleton() {}

    //åœ¨æˆå‘˜ä½ç½®åˆ›å»ºè¯¥ç±»çš„å¯¹è±¡
    private static Singleton instance;

    //å¯¹å¤–æä¾›é™æ€æ–¹æ³•è·å–è¯¥å¯¹è±¡
    public static Singleton getInstance() {
        if(instance == null) {
            instance = new Singleton();
        }
        return instance;
    }
}
```
è¯´æ˜ï¼š
	ä»ä¸Šé¢ä»£ç å¯ä»¥çœ‹å‡ºè¯¥æ–¹å¼åœ¨æˆå‘˜ä½ç½®å£°æ˜Singletonç±»å‹çš„é™æ€å˜é‡ï¼Œå¹¶æ²¡æœ‰è¿›è¡Œå¯¹è±¡çš„èµ‹å€¼æ“ä½œï¼Œé‚£ä¹ˆä»€ä¹ˆæ—¶å€™èµ‹å€¼çš„å‘¢ï¼Ÿå½“è°ƒç”¨getInstance()æ–¹æ³•è·å–Singletonç±»çš„å¯¹è±¡çš„æ—¶å€™æ‰åˆ›å»ºSingletonç±»çš„å¯¹è±¡ï¼Œè¿™æ ·å°±å®ç°äº†æ‡’åŠ è½½çš„æ•ˆæœ
	ä½†æ˜¯ï¼Œåœ¨å¤šçº¿ç¨‹ç¯å¢ƒä¸‹ï¼Œä¼šå‡ºç°çº¿ç¨‹å®‰å…¨é—®é¢˜. å¦‚æœå¤šä¸ªçº¿ç¨‹èƒ½å¤ŸåŒæ—¶è¿›å…¥ if (instance == null) ï¼Œå¹¶ä¸”æ­¤æ—¶ instance ä¸º nullï¼Œé‚£ä¹ˆä¼šæœ‰å¤šä¸ªçº¿ç¨‹æ‰§è¡Œ instance = new Singleton(); è¯­å¥ï¼Œè¿™å°†å¯¼è‡´å®ä¾‹åŒ–å¤šæ¬¡ instance

> æ‡’æ±‰å¼ä¸é¥¿æ±‰å¼æ¨ªè¯„

|  | **æ‡’æ±‰å¼ğŸ˜‚å¾ˆæ‡’ï¼Œæ‹–å»¶ç—‡ï¼Œä¸åˆ°å¿…è¦æ—¶ä¸åˆ›å»ºå•ä¾‹å®ä¾‹** | **é¥¿æ±‰å¼ğŸ˜‚é¥¿äº†ï¼Œä¸€ä¸Šæ¥ï¼ˆç±»åŠ è½½æ—¶ï¼‰å°±åˆ›å»ºå•ä¾‹** |
| --- | --- | --- |
| çº¿ç¨‹å®‰å…¨ï¼ˆå¤šçº¿ç¨‹ç¯å¢ƒä¸‹èƒ½å¦ç¡®ä¿å¯¹è±¡ä»…è¢«åˆ›å»ºä¸€æ¬¡ï¼‰ | ä¸å®‰å…¨ | å®‰å…¨ |
| å•ä¾‹å®ä¾‹åˆ›å»ºæ—¶æœº|å½“Singleton.getInstance()æ–¹æ³•è¢«è°ƒç”¨æ—¶æ‰ä¼šåˆ›å»ºå®ä¾‹ï¼Œå¦‚æœç¨‹åºç”±å§‹è‡³ç»ˆéƒ½æ²¡æœ‰è°ƒç”¨è¯¥æ–¹æ³•ï¼Œåˆ™å•ä¾‹å®ä¾‹æ°¸è¿œä¸ä¼šè¢«åˆ›å»ºï¼ŒèŠ‚çœäº†å†…å­˜ç©ºé—´å’Œèµ„æº|åœ¨Singletonè¢«ç±»åŠ è½½å™¨åŠ è½½æ—¶åˆ›å»ºå•ä¾‹å¯¹è±¡ï¼Œå¹¶ä¸”ä¼šæŠŠå•ä¾‹å˜é‡ä¸€ç›´å­˜æ”¾åœ¨å†…å­˜çš„æ–¹æ³•åŒºä¸­ï¼Œç›´åˆ°ç¨‹åºç»“æŸæ‰ä¼šæŠŠå•ä¾‹å¯¹è±¡é”€æ¯ï¼Œå¦‚æœç¨‹åºç”±å§‹è‡³ç»ˆéƒ½æ²¡æœ‰ä½¿ç”¨è¯¥å®ä¾‹ï¼Œå°†ä¼šé€ æˆèµ„æºæµªè´¹|

 æ‡’æ±‰å¼æœ‰æ›´å¥½çš„æ€§èƒ½ï¼Œæ¥ä¸‹æ¥ä»‹ç»2ç§é€šè¿‡åŠ é”ä½¿å¾—æ‡’æ±‰å¼åœ¨å¤šçº¿ç¨‹ç¯å¢ƒä¸­ä¹Ÿèƒ½çº¿ç¨‹å®‰å…¨çš„æ–¹æ³•

## 5.4 æ‡’æ±‰å¼-æ–¹å¼2ï¼ˆå•é” çº¿ç¨‹å®‰å…¨ï¼‰

```java
/**
 * æ‡’æ±‰å¼
 *  çº¿ç¨‹å®‰å…¨
 */
public class Singleton {
    //ç§æœ‰æ„é€ æ–¹æ³•
    private Singleton() {}

    //åœ¨æˆå‘˜ä½ç½®åˆ›å»ºè¯¥ç±»çš„å¯¹è±¡
    private static Singleton instance;

    //å¯¹å¤–æä¾›é™æ€æ–¹æ³•è·å–è¯¥å¯¹è±¡
    public static synchronized Singleton getInstance() {
        if(instance == null) {
            instance = new Singleton();
        }
        return instance;
    }
}
```
è¯´æ˜ï¼š
	è¯¥æ–¹å¼ä¹Ÿå®ç°äº†æ‡’åŠ è½½æ•ˆæœï¼ŒåŒæ—¶åˆè§£å†³äº†çº¿ç¨‹å®‰å…¨é—®é¢˜. ä½†æ˜¯åœ¨getInstance()æ–¹æ³•ä¸Šæ·»åŠ äº†synchronizedå…³é”®å­—ï¼Œå¯¼è‡´è¯¥æ–¹æ³•çš„æ‰§è¡Œæ•ˆæœç‰¹åˆ«ä½. ä»ä¸‹é¢ä»£ç å¯ä»¥çœ‹å‡ºï¼Œå…¶å®å°±æ˜¯åœ¨åˆå§‹åŒ–instanceæ—¶æ‰ä¼šå‡ºç°çº¿ç¨‹å®‰å…¨é—®é¢˜ï¼Œä¸€æ—¦åˆå§‹åŒ–å®Œæˆå°±ä¸å­˜åœ¨äº†

## 5.5 æ‡’æ±‰å¼-æ–¹å¼3ï¼ˆåŒé‡æ£€æŸ¥é” DCLï¼Œå³ double-checked lockingï¼‰
â€‹	å†æ¥è®¨è®ºä¸€ä¸‹æ‡’æ±‰æ¨¡å¼ä¸­åŠ é”çš„é—®é¢˜ï¼Œå¯¹äº `getInstance()` æ–¹æ³•æ¥è¯´ï¼Œç»å¤§éƒ¨åˆ†çš„æ“ä½œéƒ½æ˜¯è¯»æ“ä½œï¼Œè¯»æ“ä½œæ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Œæ‰€ä»¥æˆ‘ä»¬æ²¡å¿…è®©æ¯ä¸ªçº¿ç¨‹å¿…é¡»æŒæœ‰é”æ‰èƒ½è°ƒç”¨è¯¥æ–¹æ³•ï¼Œæˆ‘ä»¬éœ€è¦è°ƒæ•´åŠ é”çš„æ—¶æœº. ç”±æ­¤ä¹Ÿäº§ç”Ÿäº†ä¸€ç§æ–°çš„å®ç°æ¨¡å¼ï¼šåŒé‡æ£€æŸ¥é”æ¨¡å¼
```java
/**
 * åŒé‡æ£€æŸ¥æ–¹å¼
 */
public class Singleton { 

    //ç§æœ‰æ„é€ æ–¹æ³•
    private Singleton() {}

    private static Singleton instance;

   //å¯¹å¤–æä¾›é™æ€æ–¹æ³•è·å–è¯¥å¯¹è±¡
    public static Singleton getInstance() {
		//ç¬¬ä¸€æ¬¡åˆ¤æ–­ï¼Œå¦‚æœinstanceä¸ä¸ºnullï¼Œä¸è¿›å…¥æŠ¢é”é˜¶æ®µï¼Œç›´æ¥è¿”å›å®ä¾‹
        if(instance == null) {
            synchronized (Singleton.class) {
                //æŠ¢åˆ°é”ä¹‹åå†æ¬¡åˆ¤æ–­æ˜¯å¦ä¸ºnull,åªèƒ½æœ‰ä¸€ä¸ªçº¿ç¨‹è¿›å…¥
                if(instance == null) {
                    instance = new Singleton();
                }
            }
        }
        return instance;
    }
}
```
â€‹	åŒé‡æ£€æŸ¥é”æ¨¡å¼æ˜¯ä¸€ç§éå¸¸å¥½çš„å•ä¾‹å®ç°æ¨¡å¼ï¼Œè§£å†³äº†å•ä¾‹ã€æ€§èƒ½ã€çº¿ç¨‹å®‰å…¨é—®é¢˜ï¼Œä¸Šé¢çš„åŒé‡æ£€æµ‹é”æ¨¡å¼çœ‹ä¸Šå»å®Œç¾æ— ç¼ºï¼Œå…¶å®æ˜¯å­˜åœ¨é—®é¢˜ï¼Œåœ¨å¤šçº¿ç¨‹çš„æƒ…å†µä¸‹ï¼Œå¯èƒ½ä¼šå‡ºç°ç©ºæŒ‡é’ˆé—®é¢˜ï¼Œå‡ºç°é—®é¢˜çš„åŸå› æ˜¯JVMåœ¨å®ä¾‹åŒ–å¯¹è±¡çš„æ—¶å€™ä¼šè¿›è¡Œä¼˜åŒ–å’ŒæŒ‡ä»¤é‡æ’åºæ“ä½œ
â€‹	è¦è§£å†³åŒé‡æ£€æŸ¥é”æ¨¡å¼å¸¦æ¥ç©ºæŒ‡é’ˆå¼‚å¸¸é—®é¢˜ï¼Œåªéœ€è¦ä½¿ç”¨ `volatile` å…³é”®å­—(å¦‚ç¬¬äºŒç§å®ç°ä»£ç æ‰€ç¤º)ï¼Œå®ƒå¯ä»¥ä¿è¯(å†…å­˜)å¯è§æ€§å’Œæœ‰åºæ€§(é˜²æ­¢æŒ‡ä»¤é‡æ’åº).  å£°æ˜å˜é‡æ˜¯volatileçš„ï¼ŒJVMä¿è¯äº†æ¯æ¬¡è¯»å˜é‡éƒ½ä»å†…å­˜ä¸­è¯»ï¼Œè·³è¿‡CPU cacheè¿™ä¸€æ­¥. åœ¨è¯»å–volatileç±»å‹çš„å˜é‡æ—¶æ€»ä¼šè¿”å›æœ€æ–°å†™å…¥çš„å€¼

```java
/**
 * åŒé‡æ£€æŸ¥æ–¹å¼2
 */
public class Singleton {
    private Singleton() {}
    private static volatile Singleton instance;
    public static Singleton getInstance() {
        if(instance == null) {
            synchronized (Singleton.class) {
                if(instance == null) {
                    instance = new Singleton();
                }
            }
        }
        return instance;
    }
}
```
å°ç»“ï¼š
	æ·»åŠ  `volatile` å…³é”®å­—ä¹‹åçš„åŒé‡æ£€æŸ¥é”æ¨¡å¼æ˜¯ä¸€ç§æ¯”è¾ƒå¥½çš„å•ä¾‹å®ç°æ¨¡å¼ï¼Œèƒ½å¤Ÿä¿è¯åœ¨å¤šçº¿ç¨‹çš„æƒ…å†µä¸‹çº¿ç¨‹å®‰å…¨ï¼Œä¹Ÿä¸ä¼šæœ‰æ€§èƒ½é—®é¢˜

## 5.6 é™æ€å†…éƒ¨ç±»æ–¹å¼
â€‹	é™æ€å†…éƒ¨ç±»å•ä¾‹æ¨¡å¼ä¸­å®ä¾‹ç”±å†…éƒ¨ç±»åˆ›å»ºï¼Œç”±äº JVM åœ¨åŠ è½½å¤–éƒ¨ç±»çš„è¿‡ç¨‹ä¸­, æ˜¯ä¸ä¼šåŠ è½½é™æ€å†…éƒ¨ç±»çš„, åªæœ‰å†…éƒ¨ç±»çš„å±æ€§/æ–¹æ³•è¢«è°ƒç”¨æ—¶æ‰ä¼šè¢«åŠ è½½, å¹¶åˆå§‹åŒ–å…¶é™æ€å±æ€§. é™æ€å±æ€§ç”±äºè¢« `static` ä¿®é¥°ï¼Œä¿è¯åªè¢«å®ä¾‹åŒ–ä¸€æ¬¡ï¼Œå¹¶ä¸”ä¸¥æ ¼ä¿è¯å®ä¾‹åŒ–é¡ºåº
```java
/**
 * é™æ€å†…éƒ¨ç±»æ–¹å¼
 *   Singleton ç±»è¢«è£…è½½äº†ï¼Œinstance ä¸ä¸€å®šè¢«åˆå§‹åŒ–
 *   SingletonHolderç±»æ²¡æœ‰è¢«ä¸»åŠ¨ä½¿ç”¨ï¼Œåªæœ‰é€šè¿‡æ˜¾å¼è°ƒç”¨getInstanceæ–¹æ³•æ—¶ï¼Œæ‰ä¼šæ˜¾å¼è£…è½½SingletonHolderç±»ï¼Œä»è€Œå®ä¾‹åŒ–instance
 */
public class Singleton {

    //ç§æœ‰æ„é€ æ–¹æ³•
    private Singleton() {}

    private static class SingletonHolder {
        private static final Singleton INSTANCE = new Singleton();
    }

    //å¯¹å¤–æä¾›é™æ€æ–¹æ³•è·å–è¯¥å¯¹è±¡
    public static Singleton getInstance() {
        return SingletonHolder.INSTANCE;
    }
}
```
è¯´æ˜ï¼š
	ç¬¬ä¸€æ¬¡åŠ è½½Singletonç±»æ—¶ä¸ä¼šå»åˆå§‹åŒ–INSTANCEï¼Œåªæœ‰ç¬¬ä¸€æ¬¡è°ƒç”¨getInstanceï¼Œè™šæ‹Ÿæœºæ‰ä¼šåŠ è½½SingletonHolderå¹¶åˆå§‹åŒ–INSTANCEï¼Œè¿™æ ·ä¸ä»…èƒ½ç¡®ä¿çº¿ç¨‹å®‰å…¨ï¼Œä¹Ÿèƒ½ä¿è¯ Singleton ç±»çš„å”¯ä¸€æ€§
å°ç»“ï¼š
	é™æ€å†…éƒ¨ç±»å•ä¾‹æ¨¡å¼æ˜¯ä¸€ç§ä¼˜ç§€çš„å•ä¾‹æ¨¡å¼ï¼Œæ˜¯å¼€æºé¡¹ç›®ä¸­æ¯”è¾ƒå¸¸ç”¨çš„ä¸€ç§å•ä¾‹æ¨¡å¼. åœ¨æ²¡æœ‰åŠ ä»»ä½•é”çš„æƒ…å†µä¸‹ï¼Œä¿è¯äº†å¤šçº¿ç¨‹ä¸‹çš„å®‰å…¨ï¼Œå¹¶ä¸”æ²¡æœ‰ä»»ä½•æ€§èƒ½å½±å“å’Œç©ºé—´çš„æµªè´¹

## 5.7 æšä¸¾æ–¹å¼
â€‹	æšä¸¾ç±»å®ç°å•ä¾‹æ¨¡å¼æ˜¯æåŠ›æ¨èçš„å•ä¾‹å®ç°æ¨¡å¼ï¼Œå› ä¸ºæšä¸¾ç±»å‹æ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Œå¹¶ä¸”åªä¼šè£…è½½ä¸€æ¬¡ï¼Œè®¾è®¡è€…å……åˆ†çš„åˆ©ç”¨äº†æšä¸¾çš„è¿™ä¸ªç‰¹æ€§æ¥å®ç°å•ä¾‹æ¨¡å¼ï¼Œæšä¸¾çš„å†™æ³•éå¸¸ç®€å•ï¼Œè€Œä¸”æšä¸¾ç±»å‹æ˜¯æ‰€ç”¨å•ä¾‹å®ç°ä¸­å”¯ä¸€ä¸€ç§ä¸ä¼šè¢«ç ´åçš„å•ä¾‹å®ç°æ¨¡å¼
```java
/**
 * æšä¸¾æ–¹å¼
 */
public enum Singleton {
    INSTANCE;
}
```
è¯´æ˜ï¼š
	æšä¸¾æ–¹å¼å±äºé¥¿æ±‰å¼æ–¹å¼
	æšä¸¾æ–¹å¼å±äºæ³¨å†Œå¼å•ä¾‹ï¼Œæ³¨å†Œå¼å•ä¾‹å°±æ˜¯å°†æ¯ä¸€ä¸ªå®ä¾‹éƒ½ç™»è®°åˆ°æŸä¸€ä¸ªåœ°æ–¹ï¼Œä½¿ç”¨å”¯ä¸€çš„æ ‡è¯†è·å–å®ä¾‹. æ³¨å†Œå¼å•ä¾‹æ¨¡å¼è¿˜æœ‰ä¸€ç§æ˜¯å®¹å™¨å¼å•ä¾‹æ¨¡å¼ï¼Œæ¯”å¦‚IOCå®¹å™¨å°±å±äºå®¹å™¨å¼å•ä¾‹

# 6 å­˜åœ¨çš„é—®é¢˜

## 6.1 é—®é¢˜æ¼”ç¤º

ç ´åå•ä¾‹æ¨¡å¼ï¼š
ä½¿ä¸Šé¢å®šä¹‰çš„å•ä¾‹ç±»ï¼ˆSingletonï¼‰å¯ä»¥åˆ›å»ºå¤šä¸ªå¯¹è±¡ï¼Œæšä¸¾æ–¹å¼é™¤å¤–. æœ‰ä¸¤ç§æ–¹å¼ï¼Œåˆ†åˆ«æ˜¯åºåˆ—åŒ–å’Œåå°„

-  **åºåˆ—åŒ–ååºåˆ—åŒ–**
Singletonç±»ï¼š 
```java
public class Singleton implements Serializable {
    //ç§æœ‰æ„é€ æ–¹æ³•
    private Singleton() {}

    private static class SingletonHolder {
        private static final Singleton INSTANCE = new Singleton();
    }

    //å¯¹å¤–æä¾›é™æ€æ–¹æ³•è·å–è¯¥å¯¹è±¡
    public static Singleton getInstance() {
        return SingletonHolder.INSTANCE;
    }
}
```
â€‹	Testç±»ï¼š 
```java
public class Test {
    public static void main(String[] args) throws Exception {
        //å¾€æ–‡ä»¶ä¸­å†™å¯¹è±¡
        //writeObject2File();
        //ä»æ–‡ä»¶ä¸­è¯»å–å¯¹è±¡
        Singleton s1 = readObjectFromFile();
        Singleton s2 = readObjectFromFile();

        //åˆ¤æ–­ä¸¤ä¸ªååºåˆ—åŒ–åçš„å¯¹è±¡æ˜¯å¦æ˜¯åŒä¸€ä¸ªå¯¹è±¡
        System.out.println(s1 == s2);
    }

    private static Singleton readObjectFromFile() throws Exception {
        //åˆ›å»ºå¯¹è±¡è¾“å…¥æµå¯¹è±¡
        ObjectInputStream ois = new ObjectInputStream(new FileInputStream("D:/a.txt"));
        //ç¬¬ä¸€ä¸ªè¯»å–Singletonå¯¹è±¡
        Singleton instance = (Singleton) ois.readObject();

        return instance;
    }

    public static void writeObject2File() throws Exception {
        //è·å–Singletonç±»çš„å¯¹è±¡
        Singleton instance = Singleton.getInstance();
        //åˆ›å»ºå¯¹è±¡è¾“å‡ºæµ
        ObjectOutputStream oos = new ObjectOutputStream(new FileOutputStream("D:/a.txt"));
        //å°†instanceå¯¹è±¡å†™å‡ºåˆ°æ–‡ä»¶ä¸­
        oos.writeObject(instance);
    }
}
```
> ä¸Šé¢ä»£ç è¿è¡Œç»“æœæ˜¯`false`ï¼Œè¡¨æ˜åºåˆ—åŒ–å’Œååºåˆ—åŒ–å·²ç»ç ´åäº†å•ä¾‹è®¾è®¡æ¨¡å¼. 


-  **åå°„**
Singletonç±»ï¼š 
```java
public class Singleton {
    //ç§æœ‰æ„é€ æ–¹æ³•
    private Singleton() {}
    
    private static volatile Singleton instance;

    //å¯¹å¤–æä¾›é™æ€æ–¹æ³•è·å–è¯¥å¯¹è±¡
    public static Singleton getInstance() {
        if(instance != null) {
            return instance;
        }

        synchronized (Singleton.class) {
            if(instance != null) {
                return instance;
            }
            instance = new Singleton();
            return instance;
        }
    }
}
```
â€‹	Testç±»ï¼š   
```java
public class Test {
    public static void main(String[] args) throws Exception {
        //è·å–Singletonç±»çš„å­—èŠ‚ç å¯¹è±¡
        Class clazz = Singleton.class;
        //è·å–Singletonç±»çš„ç§æœ‰æ— å‚æ„é€ æ–¹æ³•å¯¹è±¡
        Constructor constructor = clazz.getDeclaredConstructor();
        //å–æ¶ˆè®¿é—®æ£€æŸ¥
        constructor.setAccessible(true);

        //åˆ›å»ºSingletonç±»çš„å¯¹è±¡s1
        Singleton s1 = (Singleton) constructor.newInstance();
        //åˆ›å»ºSingletonç±»çš„å¯¹è±¡s2
        Singleton s2 = (Singleton) constructor.newInstance();

        //åˆ¤æ–­é€šè¿‡åå°„åˆ›å»ºçš„ä¸¤ä¸ªSingletonå¯¹è±¡æ˜¯å¦æ˜¯åŒä¸€ä¸ªå¯¹è±¡
        System.out.println(s1 == s2);
    }
}
```
> ä¸Šé¢ä»£ç è¿è¡Œç»“æœæ˜¯`false`ï¼Œè¡¨æ˜åºåˆ—åŒ–å’Œååºåˆ—åŒ–å·²ç»ç ´åäº†å•ä¾‹è®¾è®¡æ¨¡å¼
>
> æ³¨æ„ï¼šæšä¸¾æ–¹å¼ä¸ä¼šå‡ºç°è¿™ä¸¤ä¸ªé—®é¢˜


## 6.2 é—®é¢˜çš„è§£å†³

-  **åºåˆ—åŒ–ã€ååºåˆ—æ–¹å¼ç ´åå•ä¾‹æ¨¡å¼çš„è§£å†³æ–¹æ³•**
åœ¨Singletonç±»ä¸­æ·»åŠ `readResolve()`æ–¹æ³•ï¼Œåœ¨ååºåˆ—åŒ–æ—¶è¢«åå°„è°ƒç”¨ï¼Œå¦‚æœå®šä¹‰äº†è¿™ä¸ªæ–¹æ³•ï¼Œå°±è¿”å›è¿™ä¸ªæ–¹æ³•çš„å€¼ï¼Œå¦‚æœæ²¡æœ‰å®šä¹‰ï¼Œåˆ™è¿”å›æ–°newå‡ºæ¥çš„å¯¹è±¡
Singletonç±»ï¼š 
```java
public class Singleton implements Serializable {
    //ç§æœ‰æ„é€ æ–¹æ³•
    private Singleton() {}

    private static class SingletonHolder {
        private static final Singleton INSTANCE = new Singleton();
    }

    //å¯¹å¤–æä¾›é™æ€æ–¹æ³•è·å–è¯¥å¯¹è±¡
    public static Singleton getInstance() {
        return SingletonHolder.INSTANCE;
    }
    
    //ä¸‹é¢æ˜¯ä¸ºäº†è§£å†³åºåˆ—åŒ–ååºåˆ—åŒ–ç ´è§£å•ä¾‹æ¨¡å¼
    private Object readResolve() {
        return SingletonHolder.INSTANCE;
    }
}
```
â€‹	æºç è§£æï¼šObjectInputStreamç±»  
```java
public final Object readObject() throws IOException, ClassNotFoundException{
    ...
    // if nested read, passHandle contains handle of enclosing object
    int outerHandle = passHandle;
    try {
        Object obj = readObject0(false);//é‡ç‚¹æŸ¥çœ‹readObject0æ–¹æ³•
    .....
}
    
private Object readObject0(boolean unshared) throws IOException {
	...
    try {
		switch (tc) {
			...
			case TC_OBJECT:
				return checkResolve(readOrdinaryObject(unshared));//é‡ç‚¹æŸ¥çœ‹readOrdinaryObjectæ–¹æ³•
			...
        }
    } finally {
        depth--;
        bin.setBlockDataMode(oldMode);
    }    
}
    
private Object readOrdinaryObject(boolean unshared) throws IOException {
	...
	//isInstantiable è¿”å›trueï¼Œæ‰§è¡Œ desc.newInstance()ï¼Œé€šè¿‡åå°„åˆ›å»ºæ–°çš„å•ä¾‹ç±»ï¼Œ
    obj = desc.isInstantiable() ? desc.newInstance() : null; 
    ...
    // åœ¨Singletonç±»ä¸­æ·»åŠ  readResolve æ–¹æ³•å desc.hasReadResolveMethod() æ–¹æ³•æ‰§è¡Œç»“æœä¸ºtrue
    if (obj != null && handles.lookupException(passHandle) == null && desc.hasReadResolveMethod()) {
    	// é€šè¿‡åå°„è°ƒç”¨ Singleton ç±»ä¸­çš„ readResolve æ–¹æ³•ï¼Œå°†è¿”å›å€¼èµ‹å€¼ç»™repå˜é‡
    	// è¿™æ ·å¤šæ¬¡è°ƒç”¨ObjectInputStreamç±»ä¸­çš„readObjectæ–¹æ³•ï¼Œç»§è€Œå°±ä¼šè°ƒç”¨æˆ‘ä»¬å®šä¹‰çš„readResolveæ–¹æ³•ï¼Œæ‰€ä»¥è¿”å›çš„æ˜¯åŒä¸€ä¸ªå¯¹è±¡. é˜»æ­¢äº†å•ä¾‹è¢«ç ´å. 
    	Object rep = desc.invokeReadResolve(obj);
     	...
    }
    return obj;
}
```

-  **åå°„æ–¹å¼ç ´è§£å•ä¾‹çš„è§£å†³æ–¹æ³• **
```java
public class Singleton {
    //ç§æœ‰æ„é€ æ–¹æ³•
    private Singleton() {
        //åå°„ç ´è§£å•ä¾‹æ¨¡å¼éœ€è¦æ·»åŠ çš„ä»£ç 
        if(instance != null) {
            throw new RuntimeException();
        }
    }
    
    private static volatile Singleton instance;

    //å¯¹å¤–æä¾›é™æ€æ–¹æ³•è·å–è¯¥å¯¹è±¡
    public static Singleton getInstance() {

        if(instance != null) {
            return instance;
        }

        synchronized (Singleton.class) {
            if(instance != null) {
                return instance;
            }
            instance = new Singleton();
            return instance;
        }
    }
}
```
è¯´æ˜:
	è¿™ç§æ–¹å¼æ¯”è¾ƒå¥½ç†è§£. å½“é€šè¿‡åå°„æ–¹å¼è°ƒç”¨æ„é€ æ–¹æ³•è¿›è¡Œåˆ›å»ºåˆ›å»ºæ—¶ï¼Œç›´æ¥æŠ›å¼‚å¸¸. ä¸è¿è¡Œæ­¤ä¸­æ“ä½œ

# 7 JDKæºç è§£æ-Runtimeç±»

Runtimeç±»å°±æ˜¯ä½¿ç”¨çš„å•ä¾‹è®¾è®¡æ¨¡å¼

1.  é€šè¿‡æºä»£ç æŸ¥çœ‹ä½¿ç”¨çš„æ˜¯å“ªç§å•ä¾‹æ¨¡å¼ 
```java
public class Runtime {
    private static Runtime currentRuntime = new Runtime();

    /**
     * Returns the runtime object associated with the current Java application.
     * Most of the methods of class <code>Runtime</code> are instance
     * methods and must be invoked with respect to the current runtime object.
     *
     * @return  the <code>Runtime</code> object associated with the current
     *          Java application.
     */
    public static Runtime getRuntime() {
        return currentRuntime;
    }

    /** Don't let anyone else instantiate this class */
    private Runtime() {}
    ...
}
```
â€‹	ä»ä¸Šé¢æºä»£ç ä¸­å¯ä»¥çœ‹å‡ºRuntimeç±»ä½¿ç”¨çš„æ˜¯é¥¿æ±‰å¼ï¼ˆé™æ€å±æ€§ï¼‰æ–¹å¼æ¥å®ç°å•ä¾‹æ¨¡å¼çš„

2.  ä½¿ç”¨Runtimeç±»ä¸­çš„æ–¹æ³•  
```java
public class RuntimeDemo {
    public static void main(String[] args) throws IOException {
        //è·å–Runtimeç±»å¯¹è±¡
        Runtime runtime = Runtime.getRuntime();

        //è¿”å› Java è™šæ‹Ÿæœºä¸­çš„å†…å­˜æ€»é‡
        System.out.println(runtime.totalMemory());
        //è¿”å› Java è™šæ‹Ÿæœºè¯•å›¾ä½¿ç”¨çš„æœ€å¤§å†…å­˜é‡
        System.out.println(runtime.maxMemory());

        //åˆ›å»ºä¸€ä¸ªæ–°çš„è¿›ç¨‹æ‰§è¡ŒæŒ‡å®šçš„å­—ç¬¦ä¸²å‘½ä»¤ï¼Œè¿”å›è¿›ç¨‹å¯¹è±¡
        Process process = runtime.exec("ipconfig");
        //è·å–å‘½ä»¤æ‰§è¡Œåçš„ç»“æœï¼Œé€šè¿‡è¾“å…¥æµè·å–
        InputStream inputStream = process.getInputStream();
        byte[] arr = new byte[1024 * 1024* 100];
        int b = inputStream.read(arr);
        System.out.println(new String(arr,0,b,"gbk"));
    }
}
```

# 8 æ€»ç»“

## 8.1 å¦‚ä½•å®ç°ä¸€ä¸ªçº¿ç¨‹å®‰å…¨çš„å•ä¾‹æ¨¡å¼ï¼Ÿ 

- é€šè¿‡é¥¿æ±‰æ¨¡å¼ã€é™æ€å†…éƒ¨ç±»æ–¹å¼
- é€šè¿‡æ‡’æ±‰æ¨¡å¼åœ¨å¯¹è±¡å®ä¾‹åŒ–æ—¶ç”¨ synchronize å…³é”®å­—åŒé‡æ£€æŸ¥
- é€šè¿‡æšä¸¾å®ç°

## 8.2 å¦‚ä½•åšåˆ°çº¿ç¨‹å®‰å…¨ï¼Ÿ

- å€ŸåŠ© synchronize å…³é”®å­—å®ç°çº¿ç¨‹å®‰å…¨
- é¥¿æ±‰å¼ã€é™æ€å†…éƒ¨ç±»æ–¹å¼ï¼Œè¿™ä¸¤ç§æ–¹å¼éƒ½æ˜¯é€šè¿‡å®šä¹‰é™æ€å˜é‡ï¼Œä»¥ä¿è¯å•ä¾‹å¯¹è±¡åœ¨ç±»åˆå§‹åŒ–æ—¶å€™è¢«å®ä¾‹åŒ–. è¿™å…¶å®æ˜¯åˆ©ç”¨äº†ClassLoaderçš„çº¿ç¨‹å®‰å…¨åŠ è½½æœºåˆ¶ClassLoaderçš„loadClassæ–¹æ³•åœ¨åŠ è½½ç±»çš„æ—¶å€™ï¼Œå®é™…ä¸Šä½¿ç”¨äº† synchronized å…³é”®å­—ï¼›æ‰€ä»¥é™¤éè¢«é‡å†™ï¼Œè¿™ä¸ªæ–¹æ³•åœ¨é»˜è®¤åœ¨çº¿ç¨‹çš„æ•´ä¸ªè£…è½½ä¸­éƒ½æ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Œæ‰€ä»¥ä½¿ç”¨ç±»åŠ è½½ä¸­åˆ›å»ºçš„å¯¹è±¡æ˜¯çº¿ç¨‹å®‰å…¨çš„
- æšä¸¾å®ç°çš„å•ä¾‹æ˜¯æšä¸¾åº•å±‚ä¾èµ–Enumç±»å®ç°çš„ï¼Œå®ƒçš„æ‰€æœ‰æˆå‘˜å˜é‡éƒ½æ˜¯é™æ€çš„ï¼Œå¹¶ä¸”åœ¨é™æ€ä»£ç å—ä¸­å®ä¾‹åŒ–çš„ï¼Œæ‰€ä»¥æšä¸¾æ˜¯å¤©ç„¶çš„çº¿ç¨‹å®‰å…¨çš„

## 8.3 å¦‚ä½•ç ´åå•ä¾‹ï¼Ÿ

- åºåˆ—åŒ–å’Œååºåˆ—åŒ–ç ´åå•ä¾‹
- é€šè¿‡åå°„ç ´åå•ä¾‹

## 8.4 ä»€ä¹ˆæƒ…å†µä½¿ç”¨å“ªç§å®ç°æ–¹å¼ï¼Ÿ
â€‹	ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œä¸å»ºè®®ä½¿ç”¨ç¬¬ 3 ç§å’Œç¬¬ 4 ç§æ‡’æ±‰æ–¹å¼ï¼Œå»ºè®®ä½¿ç”¨é¥¿æ±‰æ–¹å¼. åªæœ‰åœ¨è¦æ˜ç¡®å®ç° lazy loading æ•ˆæœæ—¶ï¼Œæ‰ä¼šä½¿ç”¨ç¬¬ 6 ç§é™æ€å†…éƒ¨ç±»æ–¹å¼. å¦‚æœæ¶‰åŠåˆ°ååºåˆ—åŒ–åˆ›å»ºå¯¹è±¡æ—¶ï¼Œå¯ä»¥å°è¯•ä½¿ç”¨ç¬¬ 7 ç§æšä¸¾æ–¹å¼. å¦‚æœæœ‰å…¶ä»–ç‰¹æ®Šçš„éœ€æ±‚ï¼Œå¯ä»¥è€ƒè™‘ä½¿ç”¨ç¬¬ 5 ç§åŒæ£€é”æ–¹å¼
